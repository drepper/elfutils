'\"! tbl | nroff \-man
'\" t macro stdmacro

.de SAMPLE
.br
.RS 0
.nf
.nh
..
.de ESAMPLE
.hy
.fi
.RE
..

.TH DBGSERVER 8
.SH NAME
dbgserver \- debuginfo-related http file-server daemon

.SH SYNOPSIS
.B dbgserver
[\fIoptions\fP]

.SH DESCRIPTION
\fBdbgserver\fP serves debuginfo-related artifacts over HTTP.  It
periodically scans a set of directories for ELF/DWARF files and their
associated source code, as well as RPM files containing the above, to
build an index by their buildid.  This index is used when remote
clients use the HTTP webapi, to fetch these files by the same
buildid.

.SH OPTIONS
.TP
.BR \-F, \-\-source\-files=PATH
Add a thread to scan for ELF/DWARF/source files under the given
directory.  This option may be repeated to scan multiple paths.
Source files are matched with DWARF files based on the AT_comp_dir
(compilation directory) attributes inside it.

.TP
.BR \-R, \-\-source\-rpms=PATH
Add a thread to scan for ELF/DWARF/source files contained in RPMs
under the given directory.  This option may be repeated to scan
multiple paths.

.TP
.BR \-d, \-\-database=FILE
Set the path of the SQLITE database used to store the index.  This
file is disposable in the sense that a later rescan will repopulate
data.  It will contain absolute file path names, so it may not be
portable across machines.  It will be frequently read/written, so it
may perform well while sharing across machines or users either, due
to SQLITE locking performance.  The default database file is
$HOME/.dbgserver.sqlite.

.TP
.BR \-p, \-\-port=NUM
Set the TCP port number on which dbgserver should listen, to service
HTTP requests.  Both IPv4 and IPV6 sockets are opened, if possible.
The webapi is documented below.  The default port number is 8002.

.TP
.BR \-t, \-\-rescan\-time=SECONDS
Set the rescan time for the file and RPM directories.  This is the
amount of time the scanning threads will wait after finishing a scan,
before doing it again.  A rescan for unchanged files is fast (because
the index also stores the file mtimes).  A time of zero is acceptable,
and means that only one initial scan should performed.  The default
rescan time is 300 seconds.

.TP
.BR \-v
Increase verbosity of logging to the standard error file descriptor.
May be repeated to increase details.  The default verbosity is 0.

.SH WEBAPI

The dbgserver's webapi resembles ordinary file service, where a GET
request with a path containing a known buildid results in a file.
Unknown buildid / request combinations result in HTTP error codes.
This file service resemblance is intentional, so that an installation
can take advantage of standard HTTP management infrastructure.

There are three requests.  In each case, the buildid is encoded as a
lowercase hexadecimal string.  For example, for a program /bin/ls,
looking at the ELF note GNU_BUILD_ID:

.SAMPLE
% readelf -n /bin/ls | grep -A4 build.id
Note section [ 4] '.note.gnu.buildid' of 36 bytes at offset 0x340:
Owner          Data size  Type
GNU                   20  GNU_BUILD_ID
Build ID: 8713b9c3fb8a720137a4a08b325905c7aaf8429d
.ESAMPLE

Then the buildid HEXCODE is simply:

.SAMPLE
8713b9c3fb8a720137a4a08b325905c7aaf8429d
.ESAMPLE

.SS /buildid/\fIHEXCODE\fP/debuginfo

If the given buildid is known to the server, this request will result
in a binary object that contains the customary \fB.debug_*\fP
sections.  This may be a split debuginfo file as created by
\fBstrip\fP, or it may be an original unstripped executable.

.SS /buildid/\fIHEXCODE\fP/executable

If the given buildid is known to the server, this request will result
in a binary object that contains the normal executable segments.  This
may be a executable stripped by \fBstrip\fP, or it may be an original
unstripped executable.  \fBET_DYN\fP shared libraries are considered
to be a type of executable.

.SS /buildid/\fIHEXCODE\fP/source\fI/SOURCE/FILE\fP

If the given buildid is known to the server, this request will result
in a binary object that contains the source file mentioned.  The path
should be absolute.  Relative path names commonly appear in the DWARF
file's source-file directory, but these paths are relative to
individual compilation unit AT_comp_dir paths, and yet an executable
is made up of multiple CUs.  Therefore, to disambiguate, dbgserver
expects source-file queries to prefix relative path names with the CU
compilation-directory.

Note: contrary to RFC 3986, the client should not elide \fB../\fP or
\fB/./\fP sorts of relative path components in the directory names,
because if this is how those names appear in the DWARF files, that
is what dbgserver needs to see too.

For example:
.TS
l l.
#include <stdio.h>	/buildid/HEXCODE/source/usr/include/stdio.h
/path/to/foo.c	/buildid/HEXCODE/source/path/to/foo.c
\../bar/foo.c AT_comp_dir=/zoo	/buildid/HEXCODE/source/zoo/../bar/foo.c
.TE

.SH SECURITY

dbgserver \fBdoes not\fP include any particular security features.
While it is robust with respect to inputs, some abuse is possible.  It
forks a new thread for each incoming HTTP request, which could lead to
a denial-of-service in terms of RAM, CPU, disk I/O, or network I/O.
If this is a problem, users are advised to install dbgserver with a
reverse-proxy HTTP front-end that enforces site policies for
firewalling, authentication, authorization, and load control.

.SH FILES
.LP
.PD .1v
.TP 20
.B $HOME/.dbgserver.sqlite
default database file
.PD

.SH "SEE ALSO"
.I "dbgserver-find(1),"
.LP
.I "stap(1),"
.LP
.I "gdb(1),"
